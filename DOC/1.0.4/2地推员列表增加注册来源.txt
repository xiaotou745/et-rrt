
 use RenRenDB;
 go
 alter table dbo.Clienter
 add OperSystem nvarchar(20) not null default '';
 go
 exec sys.sp_addextendedproperty @name = N'MS_Description', @value = N'注册来源',
    @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'TABLE',
    @level1name = N'Clienter', @level2type = N'COLUMN',
    @level2name = N'OperSystem';
go
 with   t as ( select   c.Id ,
                        isnull(d.OperSystem, 'android') OperSystem ,
                        c.OperSystem cop
               from     dbo.Clienter c ( nolock )
                        left join ( select  a.ClienterId ,
                                            case when a.OperSystem = ''
                                                 then 'android'
                                                 else a.OperSystem
                                            end OperSystem
                                    from    dbo.ClienterLoginLog a ( nolock )
                                            join ( select   ClienterId ,
                                                            min(Id) id
                                                   from     dbo.ClienterLoginLog (nolock)
                                                   group by ClienterId
                                                 ) b on a.Id = b.id
                                  ) d on c.Id = d.ClienterId
             )
    update  t
    set     t.cop = t.OperSystem;

go
 alter table dbo.Clienter
 add BirthDay DateTime null;
 go
 exec sys.sp_addextendedproperty @name = N'MS_Description', @value = N'地推员生日',
    @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'TABLE',
    @level1name = N'Clienter', @level2type = N'COLUMN',
    @level2name = N'BirthDay';
go
